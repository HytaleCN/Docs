---
displayed_sidebar: gameFeaturesSidebar
sidebar_position: 1
---

# 与好友一起游玩

> 原文链接：[https://support.hytale.com/hc/en-us/articles/45324238811291-Joining-Friends](https://support.hytale.com/hc/en-us/articles/45324238811291-Joining-Friends)<br />
> 上次更新时间：2026/01/12 10:37

本文将介绍如何邀请好友加入你的单人世界，以及如何排查连接问题。

:::info[注意：]

**适用对象:** 希望在不搭建专用服务器的情况下与好友一起游玩的玩家。

**网络要求:** 好友加入依赖 UPnP 和直连，这些方式并非在所有网络环境下都可用。如果你遇到问题，请参阅“故障排查”，或直接跳转到“Tailscale 或专用服务器托管”等“替代方案”。

**早期系统:** 该功能仍在不断完善中。我们正在积极改进，但目前尚无法保证对所有人都能完美运行。

:::

:::warning[警告：]

分享码包含你的 IP 地址。切勿公开发布分享码，不要粘贴到公共聊天中，也不要在直播中展示。只应将分享码直接分享给你信任的人。

:::

## 目录

- [工作原理](#工作原理) - 好友加入系统概览
- [托管世界](#托管世界) - 分步托管指南
- [加入好友的世界](#加入好友的世界) - 如何使用分享码
- [故障排查](#故障排查) - 常见问题与解决方法
- [替代方案](#替代方案) - Tailscale 与角色互换
- [未来改进](#未来改进) - 计划中的连接增强

## 工作原理

Hytale 允许你在不运行专用服务器的情况下，将单人世界向好友开放。当你启用好友加入时，Hytale 将会：

1. 使用 UPnP（Universal Plug and Play）自动配置你的路由器
2. 生成一个包含连接信息的分享码
3. 好友粘贴分享码即可直接连接到你的游戏

分享码包含经过加密的连接候选项，其中包括你的本地网络地址、公网 IP（通过 UPnP 获取），以及任何 VPN 地址（如 Tailscale）。加入方客户端会依次尝试这些候选项，以找到可用的连接方式。

## 托管世界

1. 加载你的单人世界
2. 按下 **ESC** 打开暂停菜单
3. 点击 **Online Play**（在线游玩）
4. 将 **Allow Other Players to Join**（允许其他玩家加入）切换为 **ON**（开启）
5. （可选）设置 **Password**（密码）以限制访问
6. （可选）将 **Include Password in Share Code**（分享码包含密码）切换为开启，以在分享码中嵌入密码
7. 点击 **Save**（保存）

保存后，Hytale 会与你的路由器进行 UPnP 协商。完成后：

- 文本框中会显示一个分享码
- 下方会显示连接状态（例如 “Connected via UPnP”）
- NAT Type 会显示你的网络配置

点击 **Copy to Clipboard**（复制到剪贴板）并将分享码发送给你的好友。

## 加入好友的世界

1. 在主菜单中进入 **Servers**（服务器）
2. 点击 **Join via Code**（通过代码加入）
3. 粘贴分享码
4. 如有需要且未嵌入密码，则输入密码
5. 点击 **Connect**（连接）

客户端会按照优先级顺序尝试每一个连接候选项，直到成功连接为止。

## 故障排查

### 未生成分享码

**症状:** 点击 Save（保存）后未显示分享码，或出现错误。

**原因与解决方法:**

| 原因 | 解决方法 |
| :--- | :--- |
| 路由器中未启用 UPnP | 登录路由器管理面板并启用 UPnP |
| 路由器不支持 UPnP | 查看“[手动端口转发](#手动端口转发)”或“[替代方案](#替代方案)” |
| 多个路由器（双重 NAT） | 在所有路由器上启用 UPnP，或将电脑直接连接至主路由器 |
| 防火墙阻止 UPnP | 在 Windows 防火墙中允许 Hytale |

### 好友无法连接

**症状:** 分享码成功生成，但好友连接超时或失败。

**原因与解决方法:**

| 原因 | 解决方法 |
| :--- | :--- |
| CGNAT（运营商级 NAT） | 你的 ISP 为多个用户共享同一个公网 IP，UPnP 端口映射无法工作。请参阅“[替代方案](#替代方案)” |
| 防火墙阻止入站连接 | 在 Windows 防火墙中允许 Hytale 通过私有与公用网络 |
| UPnP 映射过期 | 重新保存 Online Play 设置以刷新映射 |
| 杀毒软件干扰 | 临时禁用杀毒软件或将 Hytale 添加为例外 |
| ISP 封锁游戏端口 | 联系 ISP 或使用 [Tailscale](#使用-tailscale) |

### 如何检查是否为 CGNAT

你的 ISP 可能使用运营商级 NAT，这意味着你与其他用户共享一个公网 IP。在这种情况下，UPnP 将无法工作。

1. 打开 PowerShell
2. 运行：`tracert -d 8.8.8.8`
3. 检查前几个跳点

如果第一个跳点是公网 IP（而非 192.168.x.x、10.x.x.x 或 172.16-31.x.x），你很可能拥有直连。如果在到达公网地址前看到多个私有 IP 段，则说明你处于 CGNAT 或双重 NAT 之下。

你也可以对比：

- 路由器的 WAN IP（在路由器管理面板中显示）
- 你的公网 IP（在浏览器中搜索 “what is my IP”）

如果两者不一致，则说明你处于 CGNAT 之后。

### 手动端口转发

如果 UPnP 失败，但你拥有直连的公网 IP：

1. 记录 Online Play（在线游玩）设置中显示的端口（默认：每次会话不同）
2. 登录路由器管理面板
3. 找到 Port Forwarding（端口转发）设置
4. 创建一条规则，将 UDP 端口转发到你电脑的本地 IP
5. 重新保存 Online Play（在线游玩）设置

### IPv6 连接

在可用的情况下，分享码会包含 IPv6 地址。如果你的好友拥有 IPv6 连接，即使 UPnP 失败，也可能直接连接。要实现这一点，双方的 ISP 都需要提供可用的 IPv6。

## 替代方案

### 尝试让好友来托管

当你无法托管时，最简单的解决方式是让好友创建世界并邀请你。不同的网络配置意味着某位玩家可以托管，而另一位则不行。

如果你已有想要共享的世界：

1. 在 `%appdata%\Hytale\saves\` 中找到你的世界存档
2. 将世界文件夹发送给你的好友
3. 由对方导入并进行托管

### 使用 Tailscale

[Tailscale](https://tailscale.com/) 使用 WireGuard 在设备之间创建点对点 VPN 隧道，可完全绕过 NAT 与防火墙问题。

**设置步骤:**

1. 双方从 [tailscale.com/download](https://tailscale.com/download) 安装 Tailscale
2. 双方登录（可使用 Google、Microsoft、GitHub 等）
3. 双方连接到各自的 Tailscale 网络

连接后，Hytale 会自动检测 Tailscale 地址并将其包含在分享码中。这些地址会作为连接候选项显示，格式类似 `100.x.x.x` 或 `fd7a:115c:a1e0::*`。

**为什么 Tailscale 有效:**

- 建立直接的点对点连接
- 可穿透大多数 NAT 配置
- 若直连失败，可回退到中继服务器
- 使用加密的 WireGuard 隧道
- 个人使用免费

当双方都运行 Tailscale 后：

1. 重新保存 Online Play 设置以生成新的分享码
2. 新分享码会将 Tailscale 地址作为高优先级候选项
3. 将该分享码分享给你的好友

### 专用服务器

对于长期运行的世界或需要容纳多位好友的情况，建议使用专用服务器。它提供：

- 更好的性能（服务器无需同时渲染游戏）
- 在你离线时也能持续运行
- 更多配置选项
- 无需 NAT 的稳定连接

**方案一：租用托管服务商**

最简单的方式是从我们 “Launch Verified” 的游戏服务器提供商中租用服务器，例如：

- [Nitrado](https://server.nitrado.net/offers/hytale)
- [Apex Hosting](https://apexminecrafthosting.com/games/hytale-server-hosting/)
- [GPORTAL](https://www.g-portal.com/en/gameserver/hytale-server-hosting)
- [Shockbyte](https://shockbyte.com/games/hytale-server-hosting)
- [Dathost](https://dathost.net/)

这些服务商负责所有网络、硬件和维护。服务器全天候在线，可从任何地方访问，无需担心 UPnP 或端口转发问题。大多数还提供一键安装 Hytale 与自动更新。

**方案二：自行托管**

如果你希望使用自有硬件，请参阅 [Server Manual](/game-features/multiplayer/hytale-server-manual.md)（服务器手册）获取设置说明。

## 技术细节

### 分享码格式

分享码是一个经过 Base64 编码并压缩的 JSON 结构，包含以下内容：

```json
{
  "HostName": "PlayerName",
  "HostUuid": "...",
  "ServerName": "World Name",
  "Password": "optional",
  "ExpiresAt": "2026-01-09T01:50:03Z",
  "Candidates": [
    {"Type": "Host", "Address": "192.168.1.100", "Port": 52102, "Priority": 1000},
    {"Type": "Host", "Address": "100.86.150.116", "Port": 52102, "Priority": 1000},
    {"Type": "UPnP", "Address": "82.12.145.33", "Port": 52102, "Priority": 900},
    ...
  ]
}
```

- **Host** 候选项：直连 IP 地址（本地网络、IPv6、Tailscale）
- **UPnP** 候选项：通过路由器端口映射获得的公网 IP
- **Priority**（优先级）：数值越高，优先级越高（1000 > 900）

客户端会按优先级遍历候选项，依次尝试连接，直到成功为止。

### 连接优先级

连接时，候选项通常按以下顺序尝试：

1. 本地网络地址（最快，同一网络）
2. Tailscale/VPN 地址（可靠，可穿透 NAT）
3. IPv6 地址（双方均支持 IPv6 时可直连）
4. UPnP 公网 IP（需要成功的端口映射）

### 安全说明

- 分享码包含你的 IP 地址——仅与信任的好友分享
- 分享码会过期（参见 `ExpiresAt`）
- 密码可提供额外一层保护，但分享码本身仍会暴露网络信息
- 可考虑使用 Tailscale 作为额外的加密层

## 未来改进

我们正在努力让好友加入在不同网络配置下更加可靠。

### 计划中的增强

**更好的 IPv6 支持**

IPv6 完全消除了 NAT，可实现玩家之间的直连。我们计划改进 IPv6 的检测与优先级排序，让拥有 IPv6 连接的玩家无需依赖 UPnP 即可连接。

**NAT 打洞**

NAT 打洞（也称 UDP 打洞）可让两个位于 NAT 之后的玩家，通过第三方服务器协调建立直连。我们正在探索将其作为一种连接方式，以解决 UPnP 失败的场景。

### 为什么不提供中继服务器？

部分游戏会提供中继服务器，用于在玩家无法直连时转发流量。但我们决定不为好友加入提供该方案。

**成本问题**

中继服务器需要为每个连接会话处理完整的游戏流量带宽。与只处理少量数据的匹配或认证服务器不同，中继服务器在玩家连接期间需要持续带宽支持。要在全球范围内大规模提供该服务，将产生高昂且持续的基础设施成本。

**更好的投入方向**

与其将资金投入到存在延迟和容量限制的中继基础设施中，不如将其用于专用服务器。以相同的成本，你可以获得：

- 24/7 可用性（不依赖主机在线）
- 更好的性能（专用资源、优化路由）
- 无中继带来的额外延迟
- 支持更多玩家

如果直连方式不适合你的情况，我们建议使用“[替代方案](#替代方案)”中的方法——尤其是用于免费点对点连接的 Tailscale，或托管的专用服务器，以获得最佳体验。
